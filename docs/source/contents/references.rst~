The human genome reference
==========================

Halvade uses the genome reference fasta file (``ucsc.hg19.fasta``) found in the GATK resource bundle to build the index files for both BWA and STAR. The fasta file comes together with an index and a dictionary file. Additionally a full dbsnp file (version 138) is used when recalibrating the basescores for the reads. These files are all found in the GATK resource bundle which is available `here <ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/>`_. The ftp site has a limited number of parallel downloads and might not load at these times. Here is how you download the files using the terminal:

.. code-block:: bash
	:linenos:

	wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/ucsc.hg19.fasta.gz
	wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/ucsc.hg19.fasta.fai.gz
	wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/ucsc.hg19.dict.gz
	wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/dbsnp_138.hg19.vcf.gz
	wget ftp://gsapubftp-anonymous@ftp.broadinstitute.org/bundle/2.8/hg19/dbsnp_138.hg19.vcf.idx.gz

Next we need to unzip all these files so they can be used in Halvade:

.. code-block:: bash
	:linenos:

	gunzip ucsc.hg19.fasta.gz && gunzip ucsc.hg19.fasta.fai.gz && gunzip ucsc.hg19.dict.gz && \
	gunzip dbsnp_138.hg19.vcf.gz && gunzip dbsnp_138.hg19.vcf.idx.gz

The index files, the reference and the dbsnp file need to be uploaded to the HDFS server if a cluster is used to run Halvade. Setting up Halvade is described in the next part of the documentation.


BWA reference for WGS/WES data
------------------------------

For the whole genome and exome sequencing pipelines the BWA aligner is used. To run BWA an index needs to be created of the reference fasta file, which will needs to be accessible by Halvade so BWA can be called correctly. The BWA binary is available in the ``bin.tar.gz`` archive, which is provided in every Halvade release. However, this is also needed by Halvade itself, so first make a copy of this archive and extract the copy.

.. code-block:: bash
	:linenos:

	cp bin.tar.gz copy_bin.tar.gz
	tar -xvf copy_bin.tar.gz
	./bin/bwa index ucsc.hg19.fasta

This process will create 5 files with the provided name as a prefix, the naming is important as Halvade finds this index by the given fasta prefix ``ucsc.hg19``. 

STAR reference for RNA-seq data
-------------------------------

.. note:: The process to build the STAR index requires a minimum of 32 GBytes of RAM, make sure the machine this is run on has sufficient RAM memory.

The RNA-seq pipeline uses the STAR aligner to perform the read alignment step. Similarly to BWA, the STAR aligner requires an index of the reference fasta file. Again this can be created by using the STAR binary which is provided in the ``bin.tar.gz`` archive which is available in every Halvade release. Make a copy of this archive as it will be needed by Halvade later on. This process can be done in the terminal as follows:

.. code-block:: bash
	:linenos:

	cp bin.tar.gz copy_bin.tar.gz
	tar -xvf copy_bin.tar.gz
	mkdir ./STAR_ref/
	./bin/STAR --genomeDir ./STAR_ref/ --genomeFastaFiles ucsc.hg19.fasta --runMode genomeGenerate --runThreadN 4

The example command given to build the STAR genome index uses 4 threads, this should be updated to reflect the number of cores available to you on the machine. After the STAR genome index has been created, the provided output folder will contain all files needed by STAR and in turn Halvade.




